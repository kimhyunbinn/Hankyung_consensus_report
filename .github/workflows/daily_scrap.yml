name: ğŸ“ˆ í•œê²½ ë¦¬í¬íŠ¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (5ë¶„ ê°„ê²©)

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ê¸°ì¤€ ì˜¤ì „ 08:00 ~ ì˜¤í›„ 22:55 (5ë¶„ ê°„ê²©)
    # UTC 23ì‹œëŠ” í•œêµ­ 08ì‹œ / UTC 0-13ì‹œëŠ” í•œêµ­ 09-22ì‹œ
    # */5 ë¥¼ ì‚¬ìš©í•˜ì—¬ 5ë¶„ë§ˆë‹¤ ì‹¤í–‰ë˜ë„ë¡ ìµœì í™”
    - cron: '*/5 23,0,1,2,3,4,5,6,7,8,9,10,11,12,13 * * *'
  
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (í…ŒìŠ¤íŠ¸ìš©)

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 3. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install requests beautifulsoup4 python-telegram-bot PyMuPDF

      - name: 4. ìŠ¤í¬ë˜í¼ ì‹¤í–‰ ë° ìš”ì•½
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scraper.py

      - name: 5. ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡(sent_reports.txt) ì—…ë°ì´íŠ¸ ì €ì¥
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add sent_reports.txt || true
          
          if git diff --staged --quiet; then
            echo "ìƒˆë¡œìš´ ë¦¬í¬íŠ¸ê°€ ì—†ì–´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
          else
            git commit -m "ğŸ“ ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ [skip ci]"
            git push
          fi
