name: ğŸ“ˆ í•œê²½ ë¦¬í¬íŠ¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (5ë¶„ ê°„ê²©)

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ì „ 08:00 ~ ì˜¤í›„ 22:55 (5ë¶„ ê°„ê²©)
    - cron: '*/5 23,0,1,2,3,4,5,6,7,8,9,10,11,12,13 * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: 2. ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜ (PDF ë Œë”ë§ìš©)
        run: |
          sudo apt-get update
          sudo apt-get install -y libmupdf-dev swig

      - name: 3. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 4. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install requests beautifulsoup4 python-telegram-bot PyMuPDF

      - name: 5. ìŠ¤í¬ë˜í¼ ì‹¤í–‰ ë° ìš”ì•½
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scraper.py

      - name: 6. ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ ì €ì¥
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add sent_reports.txt || true
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            git commit -m "ğŸ“ ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ [skip ci]"
            git push
          fi
