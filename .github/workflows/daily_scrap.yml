name: ğŸ“ˆ í•œê²½ ë¦¬í¬íŠ¸ ìë™ ëª¨ë‹ˆí„°ë§ (10ë¶„ ê°„ê²©)

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ê¸°ì¤€ ì˜¤ì „ 08:00 ~ ì˜¤í›„ 22:50ê¹Œì§€ 10ë¶„ë§ˆë‹¤ ì‹¤í–‰
    # UTC ê¸°ì¤€: 23:00 ~ 13:50 (KST = UTC + 9)
    - cron: '*/10 23,0-12 * * *'
    # ì˜¤í›„ 22:00 ì •ê° ì‹¤í–‰ ë³´ì™„
    - cron: '0 13 * * *'
  workflow_dispatch: # í•„ìš”í•  ë•Œ GitHubì—ì„œ ì§ì ‘ 'Run workflow' ë²„íŠ¼ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  build:
    runs-on: ubuntu-latest
    # Actionsê°€ íŒŒì¼ ìˆ˜ì •ì„ í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
      - name: 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 3. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install requests beautifulsoup4 python-telegram-bot PyMuPDF

      - name: 4. ìŠ¤í¬ë˜í¼ ì‹¤í–‰ ë° ìš”ì•½
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scraper.py

      - name: 5. ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡(sent_reports.txt) ì—…ë°ì´íŠ¸ ì €ì¥
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add sent_reports.txt || true
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          if git diff --staged --quiet; then
            echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            git commit -m "ğŸ“ ë³´ë‚¸ ë¦¬í¬íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸ [skip ci]"
            git push
          fi
